<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Geofencing</title>
  <style>
    body {
      background: #f9f9f9;
      font-family: Arial, sans-serif;
    }

    .container {
      width: 100%;
      max-width: 800px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    fieldset {
      border: 2px solid #0E3B32;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    legend {
      font-weight: bold;
      color: #0E3B32;
      padding: 0 10px;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .location-row {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .location-field {
      flex: 1;
      min-width: 200px;
    }

    .map-link {
      color: #333;
      cursor: default;
      word-break: break-word;
    }

    .map-link.active {
      color: #007BFF;
      text-decoration: underline;
      cursor: pointer;
    }

    input[readonly] {
      background: #f0f0f0;
    }
  </style>
</head>
<body onload="updateLocation()">
  <div class="container">
    <div style="text-align: right; margin-bottom: 10px;">
      <img src="https://velosiaims.com/wp-content/uploads/2021/09/jeddah-central.png" alt="Jeddah Central Logo" style="max-height: 60px;">
    </div>
    <h2>Stadium Zone Locator</h2>

    <fieldset>
      <legend>Auto Location</legend>
      <div class="location-row">
        <div class="location-field">
          <label>Coordinates:</label>
          <div id="coords" class="map-link">Detecting location...</div>
        </div>
        <div class="location-field">
          <label>Zone Name:</label>
          <input type="text" id="zone" readonly>
        </div>
      </div>
    </fieldset>
  </div>

  <script>
    const zones = {
      "N4": [[21.538049, 39.129603], [21.537279, 39.129829], [21.537514, 39.130516], [21.538290, 39.130285]],
      "E1": [[21.537317, 39.129971], [21.536219, 39.130376], [21.536387, 39.130928], [21.537514, 39.130548]],
      "E2": [[21.536211, 39.130368], [21.535060, 39.130768], [21.535241, 39.131285], [21.536359, 39.130932]],
      "Z1": [[21.535994, 39.129277], [21.534607, 39.129755], [21.534956, 39.130807], [21.536311, 39.130325]],
      "Z8": [[21.537353, 39.129958], [21.537008, 39.128746], [21.535950, 39.129113], [21.536339, 39.130328]],
      "N3": [[21.537289, 39.129790], [21.538107, 39.129591], [21.537854, 39.128631], [21.537056, 39.128897]],
      "N2": [[21.537851, 39.128633], [21.537608, 39.127875], [21.536814, 39.128176], [21.537053, 39.128904]],
      "Z7": [[21.536998, 39.128733], [21.536814, 39.128163], [21.535893, 39.128484], [21.536081, 39.129059]],
      "Z9": [[21.535882, 39.128520], [21.534404, 39.129046], [21.534623, 39.129745], [21.535958, 39.129252]]
    };

    function updateLocation() {
      const coordsDiv = document.getElementById("coords");
      const zoneInput = document.getElementById("zone");

      coordsDiv.textContent = "Detecting location...";
      zoneInput.value = "";

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          position => {
            const lat = parseFloat(position.coords.latitude.toFixed(6));
            const lon = parseFloat(position.coords.longitude.toFixed(6));
            const coordsText = `${lat}, ${lon}`;
            const mapLink = `https://www.google.com/maps?q=${lat},${lon}`;

            coordsDiv.textContent = coordsText;
            coordsDiv.setAttribute("data-link", mapLink);
            coordsDiv.classList.add("active");
            coordsDiv.title = "Click to open in Google Maps";
            coordsDiv.onclick = () => window.open(mapLink, '_blank');

            let matchedZone = "Unknown";
            for (const [zoneName, points] of Object.entries(zones)) {
              if (isPointInZone(lat, lon, points)) {
                matchedZone = zoneName;
                break;
              }
            }

            zoneInput.value = matchedZone;
          },
          error => {
            coordsDiv.textContent = {
              1: "Permission denied.",
              2: "Position unavailable.",
              3: "Request timed out."
            }[error.code] || "Unknown error.";
          }
        );
      } else {
        coordsDiv.textContent = "Geolocation not supported.";
      }
    }

    function isPointInZone(lat, lon, polygon) {
      let inside = false;
      for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
        const xi = polygon[i][0], yi = polygon[i][1];
        const xj = polygon[j][0], yj = polygon[j][1];

        const intersect = ((yi > lon) !== (yj > lon)) &&
                          (lat < (xj - xi) * (lon - yi) / (yj - yi) + xi);
        if (intersect) inside = !inside;
      }
      return inside;
    }
  </script>
</body>
</html>
